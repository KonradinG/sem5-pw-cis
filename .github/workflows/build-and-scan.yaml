      - name: Open alert issue (MEDIUM+)
        if: steps.gate.outcome == 'failure'
        uses: actions/github-script@v7
        env:
          DIGEST: ${{ steps.build.outputs.digest }}
          IMAGE_FULL: ghcr.io/konrading/${{ matrix.image_name }}
          IMAGE_TAG: ${{ matrix.image_tag }}
          IMAGE_REPO: ${{ matrix.image_name }}
          TABLE: ${{ steps.vulns.outputs.TABLE }}
        with:
          script: |
            const title = `Security alerts on image: ${process.env.IMAGE_TAG}`;
            const table = process.env.TABLE ? process.env.TABLE.replace(/\\n/g, "\n") : "Keine Eintr√§ge gefunden.";
            
            const body = `
**Trivy** hat mindestens MEDIUM/HIGH/CRITICAL gefunden:

- **Image**: \`${process.env.IMAGE_FULL}:${process.env.IMAGE_TAG}\`
- **Digest**: \`${process.env.DIGEST}\`
- **Run**: https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}

### üî• Gefundene Sicherheitsprobleme

| Severity | CVE | Package | Installed Version |
|---------|-----|----------|-------------------|
${table}

üìù Der vollst√§ndige JSON-Bericht liegt im Artifact **trivy-image-${process.env.IMAGE_REPO}.json**.
`;

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title,
              body,
              labels: ['security','trivy']
            });

            core.setFailed("Security findings present (MEDIUM/HIGH/CRITICAL).");
